{"version":3,"sources":["file:///Users/phuongduy/CardDeck/assets/scripts/AudioSystem/SFXManager.ts"],"names":["_decorator","Component","AudioSource","Prefab","instantiate","SFXEntry","EventManager","GameEvent","ccclass","property","SFXManager","type","audioSource","sfxMap","Map","groupMap","groupVolumes","onLoad","node","getComponent","entry","sfxEntries","sfxAudioSourcePrefab","setParent","active","set","id","clip","has","group","start","instance","gameEvents","on","PLAY_SFX","playSFXByID","onDestroy","off","audioClip","get","find","e","console","log","volume","playOneShot","warn","setGroupVolume","muteGroup"],"mappings":"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","sourcesContent":["import { _decorator, Component, AudioSource, Prefab, instantiate, AudioClip } from 'cc';\nconst { ccclass, property } = _decorator;\n\nimport { SFXID, SFXGroup } from \"./SFXEnums\";\nimport { SFXEntry } from \"./SFXEntry\";\nimport { EventManager } from '../Managers/EventManager';\nimport { GameEvent } from '../enums/GameEvent';\n\n@ccclass('SFXManager')\nexport class SFXManager extends Component {\n    @property({ type: Prefab })\n    sfxAudioSourcePrefab: Prefab = null!;\n\n    @property({ type: [SFXEntry] })\n    sfxEntries: SFXEntry[] = [];\n\n    private audioSource: AudioSource;\n\n    private sfxMap: Map<SFXID, AudioClip> = new Map();\n    private groupMap: Map<SFXGroup, AudioSource[]> = new Map();\n    private groupVolumes: Map<SFXGroup, number> = new Map();\n\n    onLoad() {\n        this.audioSource = this.node.getComponent(AudioSource)!;\n        for (const entry of this.sfxEntries) {\n            const node = instantiate(this.sfxAudioSourcePrefab);\n            node.setParent(this.node);\n            node.active = false;\n    \n            this.sfxMap.set(entry.id, entry.clip);\n    \n            if (!this.groupVolumes.has(entry.group)) {\n              this.groupVolumes.set(entry.group, 1.0);\n            }\n        }\n    }\n\n    start() {\n        EventManager.instance.gameEvents.on(GameEvent.PLAY_SFX, this.playSFXByID, this);\n    }\n\n    protected onDestroy(): void {\n        EventManager.instance.gameEvents.off(GameEvent.PLAY_SFX, this.playSFXByID, this);\n    }\n\n    public playSFXByID(id: SFXID) {\n        const audioClip = this.sfxMap.get(id);\n        const entry = this.sfxEntries.find(e => e.id === id);\n        console.log(this.sfxMap);\n        if (!audioClip || !entry) return;\n\n        const volume = this.groupVolumes.get(entry.group) ?? 1.0;\n        if (audioClip) {\n            this.audioSource.playOneShot(audioClip, volume);\n        } else {\n            console.warn(`[SFXManager] Clip not found: ${id}`);\n        }\n    }\n\n    public setGroupVolume(group: SFXGroup, volume: number) {\n        this.groupVolumes.set(group, volume);\n    }\n\n    public muteGroup(group: SFXGroup) {\n        this.setGroupVolume(group, 0);\n    }\n}"]}