{"version":3,"sources":["file:///Users/phuongduy/CardDeck/assets/scripts/AudioSystem/SFXManager.ts"],"names":["_decorator","Component","AudioSource","Prefab","instantiate","SFXEntry","EventManager","GameEvent","ccclass","property","SFXManager","type","sfxMap","Map","groupMap","groupVolumes","onLoad","entry","sfxEntries","node","sfxAudioSourcePrefab","setParent","active","audio","getComponent","clip","console","log","id","set","has","group","get","push","start","instance","gameEvents","on","PLAY_SFX","playSFXByID","onDestroy","off","find","e","volume","playOneShot","warn","setGroupVolume","muteGroup"],"mappings":"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","sourcesContent":["import { _decorator, Component, AudioSource, Prefab, instantiate } from 'cc';\nconst { ccclass, property } = _decorator;\n\nimport { SFXID, SFXGroup } from \"./SFXEnums\";\nimport { SFXEntry } from \"./SFXEntry\";\nimport { EventManager } from '../Managers/EventManager';\nimport { GameEvent } from '../enums/GameEvent';\n\n@ccclass('SFXManager')\nexport class SFXManager extends Component {\n    @property({ type: Prefab })\n    sfxAudioSourcePrefab: Prefab = null!;\n\n    @property({ type: [SFXEntry] })\n    sfxEntries: SFXEntry[] = [];\n\n    private sfxMap: Map<SFXID, AudioSource> = new Map();\n    private groupMap: Map<SFXGroup, AudioSource[]> = new Map();\n    private groupVolumes: Map<SFXGroup, number> = new Map();\n\n    onLoad() {\n        for (const entry of this.sfxEntries) {\n            const node = instantiate(this.sfxAudioSourcePrefab);\n            node.setParent(this.node);\n            node.active = false;\n    \n            const audio = node.getComponent(AudioSource)!;\n            audio.clip = entry.clip;\n    \n            console.log('Set to sfxMap:'+entry.id);\n            this.sfxMap.set(entry.id, audio);\n    \n            if (!this.groupMap.has(entry.group)) {\n              this.groupMap.set(entry.group, []);\n            }\n            this.groupMap.get(entry.group)!.push(audio);\n\n            if (!this.groupVolumes.has(entry.group)) {\n              this.groupVolumes.set(entry.group, 1.0);\n            }\n        }\n    }\n\n    start() {\n        EventManager.instance.gameEvents.on(GameEvent.PLAY_SFX, this.playSFXByID, this);\n    }\n\n    protected onDestroy(): void {\n        EventManager.instance.gameEvents.off(GameEvent.PLAY_SFX, this.playSFXByID, this);\n    }\n\n    public playSFXByID(id: SFXID) {\n        const audio = this.sfxMap.get(id);\n        const entry = this.sfxEntries.find(e => e.id === id);\n        if (!audio || !entry) return;\n\n        const volume = this.groupVolumes.get(entry.group) ?? 1.0;\n        if (audio) {\n            audio.playOneShot(audio.clip, volume);\n        } else {\n            console.warn(`[SFXManager] Clip not found: ${id}`);\n        }\n    }\n\n    public setGroupVolume(group: SFXGroup, volume: number) {\n        this.groupVolumes.set(group, volume);\n    }\n\n    public muteGroup(group: SFXGroup) {\n        this.setGroupVolume(group, 0);\n    }\n}"]}