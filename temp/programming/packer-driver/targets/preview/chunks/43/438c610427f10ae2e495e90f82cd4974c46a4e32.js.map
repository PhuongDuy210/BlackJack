{"version":3,"sources":["file:///Users/phuongduy/CardDeck/assets/scripts/DeckManager.ts"],"names":["_decorator","Component","JsonAsset","resources","SpriteFrame","Prefab","instantiate","Card","ccclass","property","DeckManager","deck","start","deckCount","length","i","cardData","shuffleDeck","onLoad","load","err","asset","console","error","json","loadSprites","promises","map","card","loadSpriteFrame","sprite","then","spriteFrame","catch","rank","suit","Promise","all","log","initCardDeck","path","resolve","reject","cardNode","cardPrefab","setPosition","Math","floor","node","addChild","addComponent","init","j","random","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, JsonAsset, Node, resources, SpriteFrame, Prefab, instantiate } from 'cc';\nconst { ccclass, property } = _decorator;\nimport { CardData } from './CardData';\nimport { Card } from './Card';\n\n@ccclass('DeckManager')\nexport class DeckManager extends Component {\n\n    @property(Prefab)\n    private cardPrefab: Prefab = null!;\n\n    private deck: CardData[] = [];\n\n    start() {\n        let deckCount = this.deck.length;\n        for (let i = 0; i < deckCount; i++) {\n            const cardData = this.deck[i];\n        }\n        this.shuffleDeck(this.deck);\n    }\n\n    onLoad() {\n        resources.load('deck', JsonAsset, (err, asset) => {\n            if (err) {\n                console.error('Failed to load card data:', err);\n                return;\n            }\n            this.deck = asset.json as CardData[];\n            this.loadSprites();\n        });\n    }\n\n    loadSprites() {\n        const promises = this.deck.map(card =>\n            this.loadSpriteFrame('sprites/Cards/'+card.sprite+'/spriteFrame').then(spriteFrame => {\n                card.spriteFrame = spriteFrame;\n            }).catch(err => {\n                console.error(`Failed to load sprite for ${card.rank} of ${card.suit}:`, err);\n            })\n        );\n\n        Promise.all(promises).then(() => {\n            console.log('All sprites loaded, starting game...');\n            this.initCardDeck();\n        }).catch(err => {\n            console.error('Error loading sprites:', err);\n        });\n    }\n\n    private loadSpriteFrame(path: string): Promise<SpriteFrame> {\n        return new Promise((resolve, reject) => {\n            resources.load(path, SpriteFrame, (err, spriteFrame) => {\n                if (err) reject(err);\n                else resolve(spriteFrame);\n            });\n        });\n    }\n\n    private initCardDeck() {\n        let deckCount = this.deck.length;\n        for (let i = 0; i < deckCount; i++) {\n            const cardData = this.deck[i];\n            console.log('Creating card:', cardData.rank, 'of', cardData.suit, cardData.spriteFrame);\n            \n            const cardNode = instantiate(this.cardPrefab);\n            cardNode.setPosition((i % 13) * 30, Math.floor(i / 13) * -40, 0);\n            this.node.addChild(cardNode);\n            let card = cardNode.addComponent(Card);\n            card.init(cardData);\n        }\n    }\n\n    private shuffleDeck(deck: any[]): void {\n        for (let i = deck.length - 1; i > 0; i--) {\n            const j = Math.floor(Math.random() * (i + 1));\n            [deck[i], deck[j]] = [deck[j], deck[i]]; // Swap\n        }\n    }\n\n    update(deltaTime: number) {\n        \n    }\n}\n\n"]}