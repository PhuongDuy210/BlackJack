{"version":3,"sources":["file:///Users/phuongduy/CardDeck/assets/scripts/AudioSystem/SFXManager.ts"],"names":["_decorator","Component","AudioSource","Prefab","instantiate","SFXEntry","ccclass","property","SFXManager","tooltip","type","clipMap","Map","sfxPool","maxPoolSize","onLoad","sfxEntries","forEach","entry","set","id","clip","usePooling","i","node","sfxAudioSourcePrefab","setParent","active","push","playSFXByID","volume","get","playSFX","console","warn","singleSFXSource","playOneShot","sourceNode","find","n","getComponent","playing","audio","play","setVolume"],"mappings":"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","sourcesContent":["import { _decorator, Component, AudioSource, AudioClip, Node, Prefab, instantiate } from 'cc';\nconst { ccclass, property } = _decorator;\n\nimport { SFXID } from \"./SFXID\";\nimport { SFXEntry } from \"./SFXEntry\";\n\n@ccclass('SFXManager')\nexport class SFXManager extends Component {\n    @property({ tooltip: 'Use pooling for SFX playback' })\n    usePooling: boolean = false;\n\n    @property({ type: AudioSource, tooltip: 'Used when pooling is disabled' })\n    singleSFXSource: AudioSource = null!;\n\n    @property({ type: Prefab, tooltip: 'Used when pooling is enabled' })\n    sfxAudioSourcePrefab: Prefab = null!;\n\n    @property({ type: [SFXEntry] })\n    sfxEntries: SFXEntry[] = [];\n\n    private clipMap: Map<SFXID, AudioClip> = new Map();\n\n    private sfxPool: Node[] = [];\n    private maxPoolSize = 10;\n\n    onLoad() {\n        this.sfxEntries.forEach(entry => {\n            this.clipMap.set(entry.id, entry.clip);\n        });\n        if (this.usePooling) {\n            for (let i = 0; i < this.maxPoolSize; i++) {\n                const node = instantiate(this.sfxAudioSourcePrefab);\n                node.setParent(this.node);\n                node.active = false;\n                this.sfxPool.push(node);\n            }\n        }\n    }\n\n    public playSFXByID(id: SFXID, volume = 1.0) {\n        const clip = this.clipMap.get(id);\n        if (clip) {\n            this.playSFX(clip, volume);\n        } else {\n            console.warn(`[SFXManager] Clip not found: ${id}`);\n        }\n    }\n    \n    public playSFX(clip: AudioClip, volume = 1.0) {\n        if (!this.usePooling) {\n            this.singleSFXSource.playOneShot(clip, volume);\n            return;\n        }\n\n        const sourceNode = this.sfxPool.find(n => !n.getComponent(AudioSource).playing);\n        if (sourceNode) {\n            const audio = sourceNode.getComponent(AudioSource);\n            sourceNode.active = true;\n            audio.clip = clip;\n            audio.volume = volume;\n            audio.play();\n        } else {\n            console.warn('[SFXManager] No available SFX source in pool');\n        }\n    }\n\n    public setVolume(volume: number) {\n        if (!this.usePooling) {\n            this.singleSFXSource.volume = volume;\n        } else {\n            this.sfxPool.forEach(node => {\n                node.getComponent(AudioSource).volume = volume;\n            });\n        }\n    }\n}"]}