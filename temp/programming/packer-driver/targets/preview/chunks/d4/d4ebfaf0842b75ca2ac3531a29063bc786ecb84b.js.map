{"version":3,"sources":["file:///Users/phuongduy/CardDeck/assets/scripts/AudioSystem/SFXManager.ts"],"names":["_decorator","Component","AudioSource","Prefab","instantiate","SFXEntry","EventManager","GameEvent","ccclass","property","SFXManager","type","sfxMap","Map","groupMap","groupVolumes","onLoad","entry","sfxEntries","node","sfxAudioSourcePrefab","setParent","active","audio","getComponent","clip","set","id","has","group","get","push","start","instance","gameEvents","on","PLAY_SFX","playSFXByID","onDestroy","off","find","e","console","log","volume","playOneShot","warn","setGroupVolume","muteGroup"],"mappings":"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","sourcesContent":["import { _decorator, Component, AudioSource, Prefab, instantiate } from 'cc';\nconst { ccclass, property } = _decorator;\n\nimport { SFXID, SFXGroup } from \"./SFXEnums\";\nimport { SFXEntry } from \"./SFXEntry\";\nimport { EventManager } from '../Managers/EventManager';\nimport { GameEvent } from '../enums/GameEvent';\n\n@ccclass('SFXManager')\nexport class SFXManager extends Component {\n    @property({ type: Prefab })\n    sfxAudioSourcePrefab: Prefab = null!;\n\n    @property({ type: [SFXEntry] })\n    sfxEntries: SFXEntry[] = [];\n\n    private sfxMap: Map<SFXID, AudioSource> = new Map();\n    private groupMap: Map<SFXGroup, AudioSource[]> = new Map();\n    private groupVolumes: Map<SFXGroup, number> = new Map();\n\n    onLoad() {\n        for (const entry of this.sfxEntries) {\n            const node = instantiate(this.sfxAudioSourcePrefab);\n            node.setParent(this.node);\n            node.active = false;\n    \n            const audio = node.getComponent(AudioSource)!;\n            audio.clip = entry.clip;\n    \n            this.sfxMap.set(entry.id, audio);\n    \n            if (!this.groupMap.has(entry.group)) {\n              this.groupMap.set(entry.group, []);\n            }\n            this.groupMap.get(entry.group)!.push(audio);\n\n            if (!this.groupVolumes.has(entry.group)) {\n              this.groupVolumes.set(entry.group, 1.0);\n            }\n        }\n    }\n\n    start() {\n        EventManager.instance.gameEvents.on(GameEvent.PLAY_SFX, this.playSFXByID, this);\n    }\n\n    protected onDestroy(): void {\n        EventManager.instance.gameEvents.off(GameEvent.PLAY_SFX, this.playSFXByID, this);\n    }\n\n    public playSFXByID(id: SFXID) {\n        const audio = this.sfxMap.get(id);\n        const entry = this.sfxEntries.find(e => e.id === id);\n        console.log(this.sfxMap);\n        if (!audio || !entry) return;\n\n        const volume = this.groupVolumes.get(entry.group) ?? 1.0;\n        if (audio) {\n            audio.playOneShot(audio.clip, volume);\n        } else {\n            console.warn(`[SFXManager] Clip not found: ${id}`);\n        }\n    }\n\n    public setGroupVolume(group: SFXGroup, volume: number) {\n        this.groupVolumes.set(group, volume);\n    }\n\n    public muteGroup(group: SFXGroup) {\n        this.setGroupVolume(group, 0);\n    }\n}"]}