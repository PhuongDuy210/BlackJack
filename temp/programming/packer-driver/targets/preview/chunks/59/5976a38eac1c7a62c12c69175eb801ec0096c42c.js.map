{"version":3,"sources":["file:///Users/phuongduy/CardDeck/assets/scripts/CustomObjectPooling/ObjectPool.ts"],"names":["_decorator","Component","Prefab","instantiate","Enum","Vec3","PoolExhaustedBehavior","Poolable","SpecialQueue","ccclass","property","ObjectPool","type","visible","exhaustBehavior","ExpandWithLimit","availableNodes","spawnedNodes","onLoad","i","amountToPool","obj","objectToPool","poolable","getComponent","addComponent","init","active","setParent","node","push","pop","length","enqueue","CreateNew","Recycle","count","oldest","dequeue","setPosition","ZERO","findIndex","n","remove"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, instantiate, Enum, Vec3 } from 'cc';\nconst { ccclass, property } = _decorator;\nimport { PoolExhaustedBehavior } from './PoolExhaustedBehavior';\nimport { Poolable } from './Poolable';\nimport { SpecialQueue } from './SpecialQueue';\n\n@ccclass('ObjectPool')\nexport class ObjectPool extends Component {\n    @property(Prefab)\n    objectToPool: Prefab = null!;\n\n    @property\n    amountToPool: number = 10;\n\n    @property({ type: Enum(PoolExhaustedBehavior) })\n    exhaustBehavior: PoolExhaustedBehavior = PoolExhaustedBehavior.CreateNew;\n\n    @property({\n        visible() {\n            return this.exhaustBehavior === PoolExhaustedBehavior.ExpandWithLimit;\n        }\n    })\n    maxPoolSize: number = 50;\n\n    private availableNodes: Node[] = [];\n    private spawnedNodes = new SpecialQueue<Node>();\n\n    onLoad() {\n        for (let i = 0; i < this.amountToPool; i++) {\n            const obj = instantiate(this.objectToPool);\n            let poolable = obj.getComponent(Poolable) || obj.addComponent(Poolable);\n            poolable.init(this);\n\n            obj.active = false;\n            obj.setParent(this.node);\n            this.availableNodes.push(obj);\n        }\n    }\n\n    public pop(): Node | null {\n        if (this.availableNodes.length > 0) {\n            let node = this.availableNodes.pop();\n            this.spawnedNodes.enqueue(node);\n            return node;\n        }\n\n        // Can't find an available Node (Pool Exhausted)\n        if (this.exhaustBehavior == PoolExhaustedBehavior.CreateNew) {\n            const obj = instantiate(this.objectToPool);\n            let poolable = obj.getComponent(Poolable) || obj.addComponent(Poolable);\n            poolable.init(this);\n\n            obj.active = false;\n            obj.setParent(this.node);\n            this.spawnedNodes.enqueue(obj);\n            this.amountToPool++;\n            return obj;\n        }\n\n        if (this.exhaustBehavior == PoolExhaustedBehavior.Recycle && this.spawnedNodes.count > 0) {\n            const oldest = this.spawnedNodes.dequeue()!;\n            this.spawnedNodes.enqueue(oldest);\n            return oldest;\n        }\n\n        return null;\n    }\n\n    public push(node: Node) {\n        node.active = false;\n        node.setPosition(Vec3.ZERO);\n        if (this.availableNodes.findIndex(n => n === node) === -1) {\n            this.availableNodes.push(node);\n        }        \n        this.spawnedNodes.remove(node);\n    }\n}"]}