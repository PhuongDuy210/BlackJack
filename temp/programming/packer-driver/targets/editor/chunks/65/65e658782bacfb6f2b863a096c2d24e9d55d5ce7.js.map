{"version":3,"sources":["file:///Users/phuongduy/CardDeck/assets/scripts/CustomObjectPooling/ObjectPool.ts"],"names":["_decorator","Component","Prefab","instantiate","Enum","Vec3","PoolExhaustedBehavior","Poolable","SpecialQueue","ccclass","property","ObjectPool","type","visible","exhaustBehavior","ExpandWithLimit","availableNodes","spawnedNodes","onLoad","i","amountToPool","obj","objectToPool","poolable","getComponent","addComponent","init","active","setParent","node","push","pop","length","enqueue","CreateNew","Recycle","count","oldest","dequeue","maxPoolSize","FailSilently","setPosition","ZERO","findIndex","n","remove"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, instantiate, Enum, Vec3 } from 'cc';\nconst { ccclass, property } = _decorator;\nimport { PoolExhaustedBehavior } from './PoolExhaustedBehavior';\nimport { Poolable } from './Poolable';\nimport { SpecialQueue } from './SpecialQueue';\n\n@ccclass('ObjectPool')\nexport class ObjectPool extends Component {\n    @property(Prefab)\n    objectToPool: Prefab = null!;\n\n    @property\n    amountToPool: number = 10;\n\n    @property({ type: Enum(PoolExhaustedBehavior) })\n    exhaustBehavior: PoolExhaustedBehavior = PoolExhaustedBehavior.CreateNew;\n\n    @property({\n        visible() {\n            return this.exhaustBehavior === PoolExhaustedBehavior.ExpandWithLimit;\n        }\n    })\n    maxPoolSize: number = 50;\n\n    private availableNodes: Node[] = [];\n    private spawnedNodes = new SpecialQueue<Node>();\n\n    onLoad() {\n        for (let i = 0; i < this.amountToPool; i++) {\n            const obj = instantiate(this.objectToPool);\n            let poolable = obj.getComponent(Poolable) || obj.addComponent(Poolable);\n            poolable.init(this);\n\n            obj.active = false;\n            obj.setParent(this.node);\n            this.availableNodes.push(obj);\n        }\n    }\n\n    public pop(): Node | null {\n        if (this.availableNodes.length > 0) {\n            let node = this.availableNodes.pop();\n            this.spawnedNodes.enqueue(node);\n            return node;\n        }\n\n        // Can't find an available Node (Pool Exhausted)\n        switch (this.exhaustBehavior) {\n            case PoolExhaustedBehavior.CreateNew:\n                const obj = instantiate(this.objectToPool);\n                let poolable = obj.getComponent(Poolable) || obj.addComponent(Poolable);\n                poolable.init(this);\n\n                obj.active = false;\n                obj.setParent(this.node);\n                this.spawnedNodes.enqueue(obj);\n                return obj;\n        \n            case PoolExhaustedBehavior.Recycle:\n                if (this.spawnedNodes.count > 0) {\n                    const oldest = this.spawnedNodes.dequeue()!;\n                    this.spawnedNodes.enqueue(oldest);\n                    return oldest;\n                }\n                break;\n\n            case PoolExhaustedBehavior.ExpandWithLimit:\n                if (this.spawnedNodes.count < this.maxPoolSize) {\n                    const obj = instantiate(this.objectToPool);\n                    let poolable = obj.getComponent(Poolable) || obj.addComponent(Poolable);\n                    poolable.init(this);\n\n                    obj.active = false;\n                    obj.setParent(this.node);\n                    this.spawnedNodes.enqueue(obj);\n                    return obj;\n                }\n                break;\n\n            case PoolExhaustedBehavior.FailSilently:\n                break;\n        }\n\n        return null;\n    }\n\n    public push(node: Node) {\n        node.active = false;\n        node.setPosition(Vec3.ZERO);\n        if (this.availableNodes.findIndex(n => n === node) === -1) {\n            this.availableNodes.push(node);\n        }        \n        this.spawnedNodes.remove(node);\n    }\n}"]}