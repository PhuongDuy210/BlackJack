{"version":3,"sources":["file:///Users/phuongduy/CardDeck/assets/scripts/AudioSystem/SFXManager.ts"],"names":["_decorator","Component","AudioSource","Prefab","instantiate","SFXEntry","ccclass","property","SFXManager","tooltip","type","visible","usePooling","clipMap","Map","sfxPool","maxPoolSize","onLoad","sfxEntries","forEach","entry","set","id","clip","i","node","sfxAudioSourcePrefab","setParent","active","push","playSFXByID","volume","get","playSFX","console","warn","singleSFXSource","playOneShot","sourceNode","find","n","getComponent","playing","audio","play","setVolume"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,W,OAAAA,W;AAA8BC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,W,OAAAA,W;;AAI7DC,MAAAA,Q,iBAAAA,Q;;;;;;;;;OAHH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBP,U;;4BAMjBQ,U,WADZF,OAAO,CAAC,YAAD,C,UAEHC,QAAQ,CAAC;AAAEE,QAAAA,OAAO,EAAE;AAAX,OAAD,C,UAGRF,QAAQ,CAAC;AAAEG,QAAAA,IAAI,EAAER,WAAR;;AAAqBS,QAAAA,OAAO,GAAE;AAAE,iBAAO,CAAC,KAAKC,UAAb;AAAyB;;AAAzD,OAAD,C,UAGRL,QAAQ,CAAC;AAAEG,QAAAA,IAAI,EAAEP,MAAR;;AAAgBQ,QAAAA,OAAO,GAAE;AAAE,iBAAO,KAAKC,UAAZ;AAAwB;;AAAnD,OAAD,C,UAGRL,QAAQ,CAAC;AAAEG,QAAAA,IAAI,EAAE;AAAA;AAAA,iCAAR;;AAAoBC,QAAAA,OAAO,GAAE;AAAE,iBAAO,KAAKC,UAAZ;AAAwB;;AAAvD,OAAD,C,2BAXb,MACaJ,UADb,SACgCP,SADhC,CAC0C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAa9BY,OAb8B,GAaG,IAAIC,GAAJ,EAbH;AAAA,eAe9BC,OAf8B,GAeZ,EAfY;AAAA,eAgB9BC,WAhB8B,GAgBhB,EAhBgB;AAAA;;AAkBtCC,QAAAA,MAAM,GAAG;AACL,eAAKC,UAAL,CAAgBC,OAAhB,CAAwBC,KAAK,IAAI;AAC7B,iBAAKP,OAAL,CAAaQ,GAAb,CAAiBD,KAAK,CAACE,EAAvB,EAA2BF,KAAK,CAACG,IAAjC;AACH,WAFD;;AAGA,cAAI,KAAKX,UAAT,EAAqB;AACjB,iBAAK,IAAIY,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKR,WAAzB,EAAsCQ,CAAC,EAAvC,EAA2C;AACvC,oBAAMC,IAAI,GAAGrB,WAAW,CAAC,KAAKsB,oBAAN,CAAxB;AACAD,cAAAA,IAAI,CAACE,SAAL,CAAe,KAAKF,IAApB;AACAA,cAAAA,IAAI,CAACG,MAAL,GAAc,KAAd;AACA,mBAAKb,OAAL,CAAac,IAAb,CAAkBJ,IAAlB;AACH;AACJ;AACJ;;AAEMK,QAAAA,WAAW,CAACR,EAAD,EAAYS,MAAM,GAAG,GAArB,EAA0B;AACxC,gBAAMR,IAAI,GAAG,KAAKV,OAAL,CAAamB,GAAb,CAAiBV,EAAjB,CAAb;;AACA,cAAIC,IAAJ,EAAU;AACN,iBAAKU,OAAL,CAAaV,IAAb,EAAmBQ,MAAnB;AACH,WAFD,MAEO;AACHG,YAAAA,OAAO,CAACC,IAAR,CAAc,gCAA+Bb,EAAG,EAAhD;AACH;AACJ;;AAEMW,QAAAA,OAAO,CAACV,IAAD,EAAkBQ,MAAM,GAAG,GAA3B,EAAgC;AAC1C,cAAI,CAAC,KAAKnB,UAAV,EAAsB;AAClB,iBAAKwB,eAAL,CAAqBC,WAArB,CAAiCd,IAAjC,EAAuCQ,MAAvC;AACA;AACH;;AAED,gBAAMO,UAAU,GAAG,KAAKvB,OAAL,CAAawB,IAAb,CAAkBC,CAAC,IAAI,CAACA,CAAC,CAACC,YAAF,CAAevC,WAAf,EAA4BwC,OAApD,CAAnB;;AACA,cAAIJ,UAAJ,EAAgB;AACZ,kBAAMK,KAAK,GAAGL,UAAU,CAACG,YAAX,CAAwBvC,WAAxB,CAAd;AACAoC,YAAAA,UAAU,CAACV,MAAX,GAAoB,IAApB;AACAe,YAAAA,KAAK,CAACpB,IAAN,GAAaA,IAAb;AACAoB,YAAAA,KAAK,CAACZ,MAAN,GAAeA,MAAf;AACAY,YAAAA,KAAK,CAACC,IAAN;AACH,WAND,MAMO;AACHV,YAAAA,OAAO,CAACC,IAAR,CAAa,8CAAb;AACH;AACJ;;AAEMU,QAAAA,SAAS,CAACd,MAAD,EAAiB;AAC7B,cAAI,CAAC,KAAKnB,UAAV,EAAsB;AAClB,iBAAKwB,eAAL,CAAqBL,MAArB,GAA8BA,MAA9B;AACH,WAFD,MAEO;AACH,iBAAKhB,OAAL,CAAaI,OAAb,CAAqBM,IAAI,IAAI;AACzBA,cAAAA,IAAI,CAACgB,YAAL,CAAkBvC,WAAlB,EAA+B6B,MAA/B,GAAwCA,MAAxC;AACH,aAFD;AAGH;AACJ;;AAnEqC,O;;;;;iBAEhB,K;;;;;;;iBAGS,I;;;;;;;iBAGA,I;;;;;;;iBAGN,E","sourcesContent":["import { _decorator, Component, AudioSource, AudioClip, Node, Prefab, instantiate } from 'cc';\nconst { ccclass, property } = _decorator;\n\nimport { SFXID } from \"./SFXID\";\nimport { SFXEntry } from \"./SFXEntry\";\n\n@ccclass('SFXManager')\nexport class SFXManager extends Component {\n    @property({ tooltip: 'Use pooling for SFX playback' })\n    usePooling: boolean = false;\n\n    @property({ type: AudioSource, visible(){ return !this.usePooling;}})\n    singleSFXSource: AudioSource = null!;\n\n    @property({ type: Prefab, visible(){ return this.usePooling;} })\n    sfxAudioSourcePrefab: Prefab = null!;\n\n    @property({ type: [SFXEntry], visible(){ return this.usePooling;} })\n    sfxEntries: SFXEntry[] = [];\n\n    private clipMap: Map<SFXID, AudioClip> = new Map();\n\n    private sfxPool: Node[] = [];\n    private maxPoolSize = 10;\n\n    onLoad() {\n        this.sfxEntries.forEach(entry => {\n            this.clipMap.set(entry.id, entry.clip);\n        });\n        if (this.usePooling) {\n            for (let i = 0; i < this.maxPoolSize; i++) {\n                const node = instantiate(this.sfxAudioSourcePrefab);\n                node.setParent(this.node);\n                node.active = false;\n                this.sfxPool.push(node);\n            }\n        }\n    }\n\n    public playSFXByID(id: SFXID, volume = 1.0) {\n        const clip = this.clipMap.get(id);\n        if (clip) {\n            this.playSFX(clip, volume);\n        } else {\n            console.warn(`[SFXManager] Clip not found: ${id}`);\n        }\n    }\n    \n    public playSFX(clip: AudioClip, volume = 1.0) {\n        if (!this.usePooling) {\n            this.singleSFXSource.playOneShot(clip, volume);\n            return;\n        }\n\n        const sourceNode = this.sfxPool.find(n => !n.getComponent(AudioSource).playing);\n        if (sourceNode) {\n            const audio = sourceNode.getComponent(AudioSource);\n            sourceNode.active = true;\n            audio.clip = clip;\n            audio.volume = volume;\n            audio.play();\n        } else {\n            console.warn('[SFXManager] No available SFX source in pool');\n        }\n    }\n\n    public setVolume(volume: number) {\n        if (!this.usePooling) {\n            this.singleSFXSource.volume = volume;\n        } else {\n            this.sfxPool.forEach(node => {\n                node.getComponent(AudioSource).volume = volume;\n            });\n        }\n    }\n}"]}