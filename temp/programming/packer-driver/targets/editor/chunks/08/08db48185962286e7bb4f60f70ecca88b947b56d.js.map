{"version":3,"sources":["file:///Users/phuongduy/CardDeck/assets/scripts/Managers/GameManager.ts"],"names":["_decorator","Component","DeckManager","EventManager","GameEvent","GameState","Player","Dealer","ccclass","property","GameManager","player","dealer","gameState","InitialDeal","start","instance","gameEvents","on","DECK_LOADED","onDeckLoaded","ANIMATION_FINISHED","onAnimationFinished","onDestroy","off","deck","console","log","initialDeal","i","playerCardData","deckManager","dealCard","dealerCardData","addCard","getHand","emit","DEAL_CARD","hasBlackjack","revealAll","endGame","participant","PlayerTurn","GAME_STARTED","playerHit","cardData","isBusted","playerStand","dealerPlay","playerDouble","shouldHit","DEALER_TURN_END","determineWinner","playerValue","getHandValue","dealerValue","result","GAME_ENDED","resetGame","resetHand","GAME_RESET"],"mappings":"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","sourcesContent":["import { _decorator, Component } from 'cc';\nconst { ccclass, property } = _decorator;\nimport { Deck } from '../Deck';\nimport { DeckManager } from './DeckManager';\nimport { EventManager } from './EventManager';\nimport { GameEvent } from '../enums/GameEvent';\nimport { GameState } from '../enums/GameState';\nimport { Player } from '../Player';\nimport { Dealer } from '../Dealer';\n\n@ccclass('GameManager')\nexport class GameManager extends Component {\n\n    @property(DeckManager)\n    private deckManager: DeckManager = null!;\n\n    private player = new Player('Player 1');\n    private dealer = new Dealer();\n\n    private gameState: GameState = GameState.InitialDeal;\n\n    start() {\n        EventManager.instance.gameEvents.on(GameEvent.DECK_LOADED, this.onDeckLoaded, this);\n        EventManager.instance.gameEvents.on(GameEvent.ANIMATION_FINISHED, this.onAnimationFinished, this);\n    }\n\n    protected onDestroy(): void {\n        EventManager.instance.gameEvents.off(GameEvent.DECK_LOADED, this.onDeckLoaded, this);\n        EventManager.instance.gameEvents.off(GameEvent.ANIMATION_FINISHED, this.onAnimationFinished, this);\n    }\n\n    private onDeckLoaded(deck: Deck) {\n        // Start the game logic here, e.g., deal initial cards\n        console.log('Game started with deck:', deck);\n    }\n\n    public initialDeal() {\n        for (let i = 0; i < 2; i++) {\n            const playerCardData = this.deckManager.dealCard();\n            const dealerCardData = this.deckManager.dealCard();\n\n            if (playerCardData) {\n                this.player.addCard(playerCardData);\n            }\n            if (dealerCardData) {\n                this.dealer.addCard(dealerCardData);\n            }\n        }\n\n        console.log('Player Hand:', this.player.getHand());\n        console.log('Dealer Hand:', this.dealer.getHand());\n\n        // EventManager.instance.gameEvents.emit(GameEvent.GAME_STARTED);\n        EventManager.instance.gameEvents.emit(GameEvent.DEAL_CARD, this.player);\n        EventManager.instance.gameEvents.emit(GameEvent.DEAL_CARD, this.dealer);\n\n        // Check for immediate blackjack\n        if (this.player.hasBlackjack() || this.dealer.hasBlackjack()) {\n            this.dealer.revealAll = true;\n            EventManager.instance.gameEvents.emit(GameEvent.DEAL_CARD, this.dealer);\n            this.endGame();\n        }\n    }\n\n    public onAnimationFinished(participant: Player | Dealer) {\n        if (this.gameState === GameState.InitialDeal && participant instanceof Player) {\n            this.gameState = GameState.PlayerTurn;\n            EventManager.instance.gameEvents.emit(GameEvent.GAME_STARTED);\n        }\n    }\n\n    public playerHit() {\n        const cardData = this.deckManager.dealCard();\n        if (cardData) {\n            this.player.addCard(cardData);\n            EventManager.instance.gameEvents.emit(GameEvent.DEAL_CARD, this.player);\n        }\n        if (this.player.isBusted()) {\n            console.log('Player busted with hand:', this.player.getHand());\n            this.dealer.revealAll = true;\n            EventManager.instance.gameEvents.emit(GameEvent.DEAL_CARD, this.dealer);\n            this.endGame();\n        }\n    }\n\n    public playerStand() {\n        console.log('Player stands with hand:', this.player.getHand());\n        this.dealerPlay();\n    }\n\n    public playerDouble() {\n        const cardData = this.deckManager.dealCard();\n        if (cardData) {\n            this.player.addCard(cardData);\n            EventManager.instance.gameEvents.emit(GameEvent.DEAL_CARD, this.player);\n        }\n        if (this.player.isBusted()) {\n            console.log('Player busted after doubling with hand:', this.player.getHand());\n            this.dealer.revealAll = true;\n            EventManager.instance.gameEvents.emit(GameEvent.DEAL_CARD, this.dealer);\n            this.endGame();\n        } else {\n            this.dealerPlay();\n        }\n    }\n\n    public dealerPlay() {\n        while (this.dealer.shouldHit()) {\n            const cardData = this.deckManager.dealCard();\n            if (cardData) {\n                this.dealer.addCard(cardData);\n                console.log('Dealer hits and receives:', cardData);\n                EventManager.instance.gameEvents.emit(GameEvent.DEAL_CARD, this.dealer);\n            }\n        }\n        console.log('Dealer Hand now:', this.dealer.getHand());\n        EventManager.instance.gameEvents.emit(GameEvent.DEALER_TURN_END);\n        this.endGame();\n    }\n\n    private determineWinner() {\n        const playerValue = this.player.getHandValue();\n        const dealerValue = this.dealer.getHandValue();\n\n        if (this.player.hasBlackjack() && this.dealer.hasBlackjack()) {\n            return 'It\\'s a tie with both having Blackjack!';\n        } else if (this.player.hasBlackjack()) {\n            return 'Player wins with Blackjack!';\n        } else if (this.dealer.hasBlackjack()) {\n            return 'Dealer wins with Blackjack!';\n        }\n\n        if (this.player.isBusted()) {\n            return 'Dealer wins! Player busted.';\n        } else if (this.dealer.isBusted()) {\n            return 'Player wins! Dealer busted.';\n        } else if (playerValue > dealerValue) {\n            return 'Player wins!';\n        } else if (dealerValue > playerValue) {\n            return 'Dealer wins!';\n        } else {\n            return 'It\\'s a tie!';\n        }\n    }\n\n    private endGame() {\n        const result = this.determineWinner();\n        console.log(result);\n        EventManager.instance.gameEvents.emit(GameEvent.GAME_ENDED, result);\n    }\n\n    private resetGame() {\n        this.player.resetHand();\n        this.dealer.resetHand();\n        this.dealer.revealAll = false;\n        EventManager.instance.gameEvents.emit(GameEvent.GAME_RESET);\n    }\n}"]}