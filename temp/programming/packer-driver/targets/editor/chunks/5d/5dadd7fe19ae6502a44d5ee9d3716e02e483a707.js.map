{"version":3,"sources":["file:///Users/phuongduy/CardDeck/assets/scripts/Managers/GameManager.ts"],"names":["_decorator","Component","DeckManager","EventManager","GameEvent","GameState","Player","Dealer","ccclass","property","GameManager","players","dealer","gameState","InitialDeal","currentHandIndex","start","instance","gameEvents","on","DECK_LOADED","onDeckLoaded","ANIMATION_FINISHED","onAnimationFinished","push","onDestroy","off","deck","console","log","initialDeal","emit","LOCK_INPUT","i","playerCardData","deckManager","dealCard","dealerCardData","addCard","DEAL_CARD","participant","PlayerTurn","GAME_STARTED","hasBlackjack","revealAll","endGame","isBusted","length","dealerPlay","PlayerTurnEnd","DealerTurnEnd","GameEnd","result","determineWinner","GAME_ENDED","UNLOCK_INPUT","playerHit","cardData","playerStand","getHand","playerDouble","playerSplit","canSplit","currentHand","splitCard","splitHand","newHand","forEach","player","getHandValue","DealerTurn","shouldHit","playerValue","dealerValue","DEALER_TURN_END","resetGame","resetHand","GAME_RESET"],"mappings":"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","sourcesContent":["import { _decorator, Component } from 'cc';\nconst { ccclass, property } = _decorator;\nimport { Deck } from '../Deck';\nimport { DeckManager } from './DeckManager';\nimport { EventManager } from './EventManager';\nimport { GameEvent } from '../enums/GameEvent';\nimport { GameState } from '../enums/GameState';\nimport { Player } from '../Player';\nimport { Dealer } from '../Dealer';\n\n@ccclass('GameManager')\nexport class GameManager extends Component {\n\n    @property(DeckManager)\n    private deckManager: DeckManager = null!;\n\n    private players: Player[] = [];\n    private dealer = new Dealer();\n\n    private gameState: GameState = GameState.InitialDeal;\n\n    private currentHandIndex = 0;\n\n    start() {\n        EventManager.instance.gameEvents.on(GameEvent.DECK_LOADED, this.onDeckLoaded, this);\n        EventManager.instance.gameEvents.on(GameEvent.ANIMATION_FINISHED, this.onAnimationFinished, this);\n\n        this.players.push(new Player('Player 1', 0));\n    }\n\n    protected onDestroy(): void {\n        EventManager.instance.gameEvents.off(GameEvent.DECK_LOADED, this.onDeckLoaded, this);\n        EventManager.instance.gameEvents.off(GameEvent.ANIMATION_FINISHED, this.onAnimationFinished, this);\n    }\n\n    private onDeckLoaded(deck: Deck) {\n        // Start the game logic here, e.g., deal initial cards\n        console.log('Game started with deck:', deck);\n    }\n\n    public initialDeal() {\n        EventManager.instance.gameEvents.emit(GameEvent.LOCK_INPUT);\n        for (let i = 0; i < 2; i++) {\n            const playerCardData = this.deckManager.dealCard();\n            const dealerCardData = this.deckManager.dealCard();\n\n            if (playerCardData) {\n                this.players[this.currentHandIndex].addCard(playerCardData);\n            }\n            if (dealerCardData) {\n                this.dealer.addCard(dealerCardData);\n            }\n        }\n\n        EventManager.instance.gameEvents.emit(GameEvent.DEAL_CARD, this.players[this.currentHandIndex]);\n        EventManager.instance.gameEvents.emit(GameEvent.DEAL_CARD, this.dealer);\n    }\n\n    public onAnimationFinished(participant: Player | Dealer) {\n        console.log('Animation finished for:', participant instanceof Player ? 'Player' : 'Dealer');\n        if (this.gameState === GameState.InitialDeal && participant instanceof Player) {\n            this.gameState = GameState.PlayerTurn;\n            EventManager.instance.gameEvents.emit(GameEvent.GAME_STARTED, this.players[this.currentHandIndex]);\n\n            // Check for immediate blackjack\n            if (this.players[this.currentHandIndex].hasBlackjack() || this.dealer.hasBlackjack()) {\n                this.dealer.revealAll = true;\n                this.endGame();\n            }\n        }\n\n        if (this.gameState === GameState.PlayerTurn && participant instanceof Player) {\n            if (this.players[this.currentHandIndex].isBusted()) {\n                if ((this.currentHandIndex + 1) == this.players.length) {\n                    this.dealerPlay();\n                } else {\n                    this.currentHandIndex++;\n                }\n            }\n        }\n\n        if (this.gameState === GameState.PlayerTurnEnd && participant instanceof Player) {\n            this.dealer.revealAll = true;\n            this.dealerPlay();\n        }\n\n        if (this.gameState === GameState.DealerTurnEnd && participant instanceof Dealer) {\n            this.gameState = GameState.GameEnd;\n            const result = this.determineWinner();\n            EventManager.instance.gameEvents.emit(GameEvent.GAME_ENDED, result);\n        }\n\n        EventManager.instance.gameEvents.emit(GameEvent.UNLOCK_INPUT);\n    }\n\n    public playerHit() {\n        EventManager.instance.gameEvents.emit(GameEvent.LOCK_INPUT);\n        const cardData = this.deckManager.dealCard();\n        if (cardData) {\n            this.players[this.currentHandIndex].addCard(cardData);\n            EventManager.instance.gameEvents.emit(GameEvent.DEAL_CARD, this.players[this.currentHandIndex]);\n        }\n    }\n\n    public playerStand() {\n        EventManager.instance.gameEvents.emit(GameEvent.LOCK_INPUT);\n        console.log('Player stands with hand:', this.players[this.currentHandIndex].getHand());\n        if ((this.currentHandIndex + 1) == this.players.length) {\n            this.dealerPlay();\n        } else {\n            this.currentHandIndex++;\n        }\n    }\n\n    public playerDouble() {\n        EventManager.instance.gameEvents.emit(GameEvent.LOCK_INPUT);\n        const cardData = this.deckManager.dealCard();\n        if (cardData) {\n            this.players[this.currentHandIndex].addCard(cardData);\n            EventManager.instance.gameEvents.emit(GameEvent.DEAL_CARD, this.players[this.currentHandIndex]);\n        }\n        if ((this.currentHandIndex + 1) == this.players.length) {\n            this.gameState = GameState.PlayerTurnEnd;\n        } else {\n            this.currentHandIndex++;\n        }\n    }\n\n    public playerSplit() {\n        console.log('player split');\n        if (!this.players[this.currentHandIndex].canSplit()) {\n            return;\n        }\n        let currentHand = this.players[this.currentHandIndex];\n        const splitCard = currentHand.splitHand();\n\n        let newHand = new Player('Player 1', this.currentHandIndex + 1);\n        newHand.addCard(splitCard);\n        console.log('After splitting: '+ this.players);\n        EventManager.instance.gameEvents.emit(GameEvent.DEAL_CARD, this.players[this.currentHandIndex + 1]);\n        this.players.push(newHand);\n        this.players.forEach(player => {\n            console.log('After splitting: '+ player.getHandValue());\n        });\n    }\n\n    public dealerPlay() {\n        EventManager.instance.gameEvents.emit(GameEvent.LOCK_INPUT);\n        this.gameState = GameState.DealerTurn;\n        while (this.dealer.shouldHit() && !this.players[this.currentHandIndex].isBusted()) {\n            const cardData = this.deckManager.dealCard();\n            if (cardData) {\n                this.dealer.addCard(cardData);\n                console.log('Dealer hits and receives:', cardData);\n                EventManager.instance.gameEvents.emit(GameEvent.DEAL_CARD, this.dealer);\n            }\n        }\n        console.log('Dealer Hand now:', this.dealer.getHand());\n        this.endGame();\n    }\n\n    private determineWinner() {\n        console.log('Determining winner...');\n        const playerValue = this.players[this.currentHandIndex].getHandValue();\n        const dealerValue = this.dealer.getHandValue();\n\n        let result = '';\n        if (this.players[this.currentHandIndex].hasBlackjack() && this.dealer.hasBlackjack()) {\n            result = 'It\\'s a tie with both having Blackjack!';\n        } else if (this.players[this.currentHandIndex].hasBlackjack()) {\n            result = 'Player wins with Blackjack!';\n        } else if (this.dealer.hasBlackjack()) {\n            result = 'Dealer wins with Blackjack!';\n        } else if (this.players[this.currentHandIndex].isBusted()) {\n            result = 'Dealer wins! Player busted.';\n        } else if (this.dealer.isBusted()) {\n            result = 'Player wins! Dealer busted.';\n        } else if (playerValue > dealerValue) {\n            result = 'Player wins!';\n        } else if (dealerValue > playerValue) {\n            result = 'Dealer wins!';\n        } else {\n            result = 'It\\'s a tie!';\n        }\n        \n        return result;\n    }\n    \n    private endGame() {\n        EventManager.instance.gameEvents.emit(GameEvent.DEALER_TURN_END);\n        this.gameState = GameState.DealerTurnEnd;\n    }\n\n    private resetGame() {\n        this.players.forEach(player => {\n            player.resetHand();   \n        });\n        this.dealer.resetHand();\n        this.dealer.revealAll = false;\n        EventManager.instance.gameEvents.emit(GameEvent.GAME_RESET);\n        this.gameState = GameState.InitialDeal;\n    }\n}"]}