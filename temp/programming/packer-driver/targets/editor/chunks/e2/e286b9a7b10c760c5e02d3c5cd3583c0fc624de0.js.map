{"version":3,"sources":["file:///Users/phuongduy/CardDeck/assets/scripts/CustomObjectPooling/ObjectPooling.ts"],"names":["_decorator","Component","Prefab","instantiate","ccclass","property","ObjectPool","pooledObjects","spawnedObjects","SpecialQueue","onLoad","i","amountToPool","obj","objectToPool","active","setParent","node","push","popObjectFromPool","length","contains","remove","enqueue","createNew","recycle","count","oldest","dequeue"],"mappings":";;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,W,OAAAA,W;;;;;;;;;OACxC;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBL,U;;4BAGjBM,U,WADZF,OAAO,CAAC,YAAD,C,UAEHC,QAAQ,CAACH,MAAD,C,2BAFb,MACaI,UADb,SACgCL,SADhC,CAC0C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAa9BM,aAb8B,GAaN,EAbM;AAAA,eAc9BC,cAd8B,GAcb,IAAIC,YAAJ,EAda;AAAA;;AAgBtCC,QAAAA,MAAM,GAAG;AACL,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKC,YAAzB,EAAuCD,CAAC,EAAxC,EAA4C;AACxC,kBAAME,GAAG,GAAGV,WAAW,CAAC,KAAKW,YAAN,CAAvB;AACAD,YAAAA,GAAG,CAACE,MAAJ,GAAa,KAAb;AACAF,YAAAA,GAAG,CAACG,SAAJ,CAAc,KAAKC,IAAnB;AACA,iBAAKV,aAAL,CAAmBW,IAAnB,CAAwBL,GAAxB;AACH;AACJ;;AAEMM,QAAAA,iBAAiB,GAAgB;AACpC,eAAK,IAAIR,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKJ,aAAL,CAAmBa,MAAvC,EAA+CT,CAAC,EAAhD,EAAoD;AAChD,kBAAME,GAAG,GAAG,KAAKN,aAAL,CAAmBI,CAAnB,CAAZ;;AACA,gBAAI,CAACE,GAAG,CAACE,MAAT,EAAiB;AACb,kBAAI,KAAKP,cAAL,CAAoBa,QAApB,CAA6BR,GAA7B,CAAJ,EAAuC;AACnC,qBAAKL,cAAL,CAAoBc,MAApB,CAA2BT,GAA3B;AACH;;AACD,mBAAKL,cAAL,CAAoBe,OAApB,CAA4BV,GAA5B;AACA,qBAAOA,GAAP;AACH;AACJ;;AAED,cAAI,KAAKW,SAAT,EAAoB;AAChB,kBAAMX,GAAG,GAAGV,WAAW,CAAC,KAAKW,YAAN,CAAvB;AACAD,YAAAA,GAAG,CAACE,MAAJ,GAAa,KAAb;AACAF,YAAAA,GAAG,CAACG,SAAJ,CAAc,KAAKC,IAAnB;AACA,iBAAKV,aAAL,CAAmBW,IAAnB,CAAwBL,GAAxB;AACA,iBAAKL,cAAL,CAAoBe,OAApB,CAA4BV,GAA5B;AACA,iBAAKD,YAAL;AACA,mBAAOC,GAAP;AACH;;AAED,cAAI,KAAKY,OAAL,IAAgB,KAAKjB,cAAL,CAAoBkB,KAApB,GAA4B,CAAhD,EAAmD;AAC/C,kBAAMC,MAAM,GAAG,KAAKnB,cAAL,CAAoBoB,OAApB,EAAf;AACA,iBAAKpB,cAAL,CAAoBe,OAApB,CAA4BI,MAA5B;AACA,mBAAOA,MAAP;AACH;;AAED,iBAAO,IAAP;AACH;;AAtDqC,O;;;;;iBAEf,I;;uFAEtBtB,Q;;;;;iBACsB,E;;oFAEtBA,Q;;;;;iBACoB,I;;kFAEpBA,Q;;;;;iBACkB,K","sourcesContent":["import { _decorator, Component, Node, Prefab, instantiate } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('ObjectPool')\nexport class ObjectPool extends Component {\n    @property(Prefab)\n    objectToPool: Prefab = null!;\n\n    @property\n    amountToPool: number = 10;\n\n    @property\n    createNew: boolean = true;\n\n    @property\n    recycle: boolean = false;\n\n    private pooledObjects: Node[] = [];\n    private spawnedObjects = new SpecialQueue<Node>();\n\n    onLoad() {\n        for (let i = 0; i < this.amountToPool; i++) {\n            const obj = instantiate(this.objectToPool);\n            obj.active = false;\n            obj.setParent(this.node);\n            this.pooledObjects.push(obj);\n        }\n    }\n\n    public popObjectFromPool(): Node | null {\n        for (let i = 0; i < this.pooledObjects.length; i++) {\n            const obj = this.pooledObjects[i];\n            if (!obj.active) {\n                if (this.spawnedObjects.contains(obj)) {\n                    this.spawnedObjects.remove(obj);\n                }\n                this.spawnedObjects.enqueue(obj);\n                return obj;\n            }\n        }\n\n        if (this.createNew) {\n            const obj = instantiate(this.objectToPool);\n            obj.active = false;\n            obj.setParent(this.node);\n            this.pooledObjects.push(obj);\n            this.spawnedObjects.enqueue(obj);\n            this.amountToPool++;\n            return obj;\n        }\n\n        if (this.recycle && this.spawnedObjects.count > 0) {\n            const oldest = this.spawnedObjects.dequeue()!;\n            this.spawnedObjects.enqueue(oldest);\n            return oldest;\n        }\n\n        return null;\n    }\n}"]}