{"version":3,"sources":["file:///Users/phuongduy/CardDeck/assets/scripts/Managers/UIManager.ts"],"names":["_decorator","Button","Component","Node","Prefab","instantiate","Vec3","Label","tween","UITransform","EventManager","GameEvent","Card","Player","Dealer","ChipButton","ccclass","property","UIManager","chipStacks","Map","playerAnimationInProgress","dealerAnimationInProgress","start","instance","gameEvents","on","DECK_LOADED","onDeckLoaded","CHIP_ENTRY_READY","setupChipButtons","CHIP_SELECTED","addChip","GAME_STARTED","onGameStarted","DEAL_CARD","addCardToParticipant","GAME_ENDED","displayResult","GAME_RESET","resetUI","DEALER_TURN_END","flipDealerCards","LOCK_INPUT","lockInput","UNLOCK_INPUT","unlockInput","console","log","dealButton","interactable","node","active","hitButton","standButton","doubleButton","resultLabel","resetButton","playerScoreLabel","dealerScoreLabel","playerCardContainer","removeAllChildren","dealerCardContainer","onDestroy","off","chipEntries","entry","chipNode","chipButtonPrefab","setParent","bettingArea","chipWidth","getComponent","width","spacing","totalWidth","length","startX","chipButton","setup","setPosition","i","x","chipEntry","stackCount","get","value","baseX","baseY","offsetX","offsetY","size","participant","handArea","hand","getHand","children","animateCardToHand","emit","ANIMATION_FINISHED","displayedCardCount","latestCardData","cardNode","cardPrefab","card","addComponent","init","scoreLabel","isFaceDown","revealAll","addChild","setWorldPosition","deckPosition","getWorldPosition","targetPos","getCardTargetPosition","Promise","resolve","to","position","call","flipCard","checkRemainingAnimation","string","getHandValue","dealerCardNodes","cardIndex","xOffset","yOffset","y","Math","floor","result"],"mappings":"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","sourcesContent":["import { _decorator, Button, Component, Node, Prefab, instantiate, Vec3, Label, tween, UITransform } from 'cc';\nimport { EventManager } from './EventManager';\nimport { GameEvent } from '../enums/GameEvent';\nimport { Card } from '../Card';\n\nimport { Participant } from '../Participant';\nimport { Player } from '../Player';\nimport { Dealer } from '../Dealer';\n\nimport { ChipEntry } from '../Chip/ChipEntry';\nimport { ChipButton } from '../Chip/ChipButton';\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('UIManager')\nexport class UIManager extends Component {\n    @property(Prefab)\n    private cardPrefab: Prefab = null!;\n\n    @property(Label)\n    private resultLabel: Label = null!;\n\n    @property(Button)\n    private dealButton: Button = null!;\n\n    @property(Button)\n    private hitButton: Button = null!;\n\n    @property(Button)\n    private standButton: Button = null!;\n\n    @property(Button)\n    private doubleButton: Button = null!;\n\n    @property(Button)\n    private resetButton: Button = null!;\n\n    @property(Node)\n    private deckPosition: Node = null!;\n\n    @property(Node)\n    private playerCardContainer: Node = null!;\n\n    @property(Label)\n    private playerScoreLabel: Label = null!;\n\n    @property(Label)\n    private dealerScoreLabel: Label = null!;\n\n    @property(Node)\n    private dealerCardContainer: Node = null!;\n\n    @property(Node)\n    private bettingArea: Node = null!;\n\n    @property(Node)\n    private potArea: Node = null!;\n\n    @property(Prefab)\n    private chipButtonPrefab: Prefab = null!;\n\n    private chipStacks: Map<number, number> = new Map(); // key: chip value, value: count\n\n    private playerAnimationInProgress: number = 0;\n    private dealerAnimationInProgress: number = 0;\n\n    start() {\n        EventManager.instance.gameEvents.on(GameEvent.DECK_LOADED, this.onDeckLoaded, this);\n        EventManager.instance.gameEvents.on(GameEvent.CHIP_ENTRY_READY, this.setupChipButtons, this);\n        EventManager.instance.gameEvents.on(GameEvent.CHIP_SELECTED, this.addChip, this);\n        EventManager.instance.gameEvents.on(GameEvent.GAME_STARTED, this.onGameStarted, this);\n        EventManager.instance.gameEvents.on(GameEvent.DEAL_CARD, this.addCardToParticipant, this);\n        EventManager.instance.gameEvents.on(GameEvent.GAME_ENDED, this.displayResult, this);\n        EventManager.instance.gameEvents.on(GameEvent.GAME_RESET, this.resetUI, this);\n        EventManager.instance.gameEvents.on(GameEvent.DEALER_TURN_END, this.flipDealerCards, this);\n        EventManager.instance.gameEvents.on(GameEvent.LOCK_INPUT, this.lockInput, this);\n        EventManager.instance.gameEvents.on(GameEvent.UNLOCK_INPUT, this.unlockInput, this);\n\n        this.resetUI();\n    }\n\n    private resetUI() {\n        console.log('Resetting UI...');\n        this.dealButton.interactable = false;\n        this.dealButton.node.active = true;\n        this.hitButton.node.active = false;\n        this.standButton.node.active = false;\n        this.doubleButton.node.active = false;\n        this.resultLabel.node.active = false;\n        this.resetButton.node.active = false;\n        this.playerScoreLabel.node.active = false;\n        this.dealerScoreLabel.node.active = false;\n\n        this.playerCardContainer.removeAllChildren();\n        this.dealerCardContainer.removeAllChildren();\n    }\n\n    protected onDestroy(): void {\n        EventManager.instance.gameEvents.off(GameEvent.CHIP_ENTRY_READY, this.setupChipButtons, this);\n        EventManager.instance.gameEvents.off(GameEvent.DECK_LOADED, this.onDeckLoaded, this);\n        EventManager.instance.gameEvents.off(GameEvent.GAME_STARTED, this.onGameStarted, this);\n        EventManager.instance.gameEvents.off(GameEvent.DEAL_CARD, this.addCardToParticipant, this);\n        EventManager.instance.gameEvents.off(GameEvent.GAME_ENDED, this.displayResult, this);\n        EventManager.instance.gameEvents.off(GameEvent.GAME_RESET, this.resetUI, this);\n        EventManager.instance.gameEvents.off(GameEvent.DEALER_TURN_END, this.flipDealerCards, this);\n    }\n\n    private onDeckLoaded() {\n        this.dealButton.interactable = true;\n    }\n\n    private setupChipButtons(chipEntries: ChipEntry[]) {\n        const entry = chipEntries[0];\n        const chipNode = instantiate(this.chipButtonPrefab);\n        chipNode.setParent(this.bettingArea);\n        const chipWidth = chipNode.getComponent(UITransform).width;\n\n        const spacing = 10;\n        const totalWidth = chipEntries.length * (chipWidth + spacing);\n        const startX = -totalWidth / 2 + (chipWidth + spacing) / 2;\n\n        const chipButton = chipNode.getComponent(ChipButton);\n        chipButton.setup(entry);\n        chipNode.setPosition(startX, 0);\n        \n        for (let i = 1; i < chipEntries.length; i++) {\n            const entry = chipEntries[i];\n            const chipNode = instantiate(this.chipButtonPrefab);\n            chipNode.setParent(this.bettingArea);\n\n            const chipButton = chipNode.getComponent(ChipButton);\n            chipButton.setup(entry);\n            const x = startX + i * (chipWidth + spacing);\n            chipNode.setPosition(x, 0);\n        }\n    }\n\n    private addChip(chipEntry: ChipEntry) {\n        const chipNode = instantiate(this.chipButtonPrefab);\n        const chipButton = chipNode.getComponent(ChipButton);\n        chipButton.setup(chipEntry);\n\n        // Get current stack count\n        const stackCount = this.chipStacks.get(chipEntry.value) ?? 0;\n\n        // Position chip with vertical offset\n        const baseX = 0; // or any fixed X position\n        const baseY = 0;\n        const offsetX = 10; // pixels between stacked chips\n        const offsetY = 5; // pixels between stacked chips\n\n        chipNode.setPosition(baseX + this.chipStacks.size * offsetX, baseY + stackCount * offsetY);\n    }\n\n    private onGameStarted() {\n        this.dealButton.node.active = false;\n        this.hitButton.node.active = true;\n        this.standButton.node.active = true;\n        this.doubleButton.node.active = true;\n    }\n\n    async addCardToParticipant(participant: Participant) {\n        let handArea = null;\n        if (participant instanceof Player) {\n            handArea = this.playerCardContainer;\n        } else if (participant instanceof Dealer) {\n            handArea = this.dealerCardContainer;\n        }\n\n        const hand = participant.getHand();\n        for (let i = handArea.children.length; i < hand.length; i++) {\n            await this.animateCardToHand(participant, handArea);\n        }\n        EventManager.instance.gameEvents.emit(GameEvent.ANIMATION_FINISHED, participant);\n    }\n\n    async animateCardToHand(participant: Participant, handArea: Node): Promise<void> {\n        const hand = participant.getHand();\n        const displayedCardCount = handArea.children.length;\n        if (displayedCardCount >= hand.length) {\n            return;\n        }\n        const latestCardData = hand[displayedCardCount];\n\n        // Get or create visual card node\n        const cardNode = instantiate(this.cardPrefab);\n        let card = cardNode.addComponent(Card);\n        card.init(latestCardData);\n        \n        // Add to scene\n        let scoreLabel;\n        if (participant instanceof Player) {\n            latestCardData.isFaceDown = false;\n            this.playerAnimationInProgress++;\n            scoreLabel = this.playerScoreLabel;\n        } else if (participant instanceof Dealer) {\n            latestCardData.isFaceDown = (displayedCardCount === 0 && !participant.revealAll);\n            this.dealerAnimationInProgress++;\n            scoreLabel = this.dealerScoreLabel;\n        }\n        handArea.addChild(cardNode);\n        \n        // Position at deck first\n        cardNode.setWorldPosition(this.deckPosition.getWorldPosition());\n        \n        // Animate to hand position\n        const targetPos = this.getCardTargetPosition(displayedCardCount);\n        await new Promise<void>((resolve) => {\n            tween(cardNode)\n            .to(0.5, { position: targetPos })\n            .call(async () => {\n                if (!latestCardData.isFaceDown) {\n                    await card.flipCard();\n                    this.checkRemainingAnimation(participant);\n                    scoreLabel.string = 'Hand Value: ' + participant.getHandValue();\n                }\n                resolve();\n            })\n            .start();\n        });\n    }\n    \n    async flipDealerCards() {\n        const dealerCardNodes = this.dealerCardContainer.children;\n        for (let i = 0; i < dealerCardNodes.length; i++) {\n            const cardNode = dealerCardNodes[0];\n            const card = cardNode.getComponent(Card);\n            if (card.isFaceDown) {\n                await card.flipCard();\n                this.checkRemainingAnimation(new Dealer);\n            }\n        }\n    }\n    \n    private checkRemainingAnimation(participant: Participant) {\n        if (participant instanceof Player) {\n            this.playerAnimationInProgress--;\n        } else if (participant instanceof Dealer) {\n            this.dealerAnimationInProgress--;\n        }\n        console.log('Player animations left:', this.playerAnimationInProgress, 'Dealer animations left:', this.dealerAnimationInProgress);\n        if ((this.playerAnimationInProgress <= 0 && participant instanceof Player) ||\n            (this.dealerAnimationInProgress <= 0 && participant instanceof Dealer)) {\n            console.log('All animations finished.');\n            EventManager.instance.gameEvents.emit(GameEvent.ANIMATION_FINISHED, participant);\n        }\n    }\n\n    private getCardTargetPosition(cardIndex: number): Vec3 {\n        const xOffset = 50;\n        const yOffset = -40;\n        const x = (cardIndex % 13) * xOffset;\n        const y = Math.floor(cardIndex / 13) * yOffset;\n        return new Vec3(x, y, 0);\n    }\n\n    private displayResult(result: string) {\n        // Implement result display logic (e.g., show a popup or update a label)\n        console.log('Game Result:', result);\n        this.resultLabel.node.active = true;\n        this.resultLabel.string = result;\n        this.hitButton.node.active = false;\n        this.standButton.node.active = false;\n        this.resetButton.node.active = true;\n        this.doubleButton.node.active = false;\n\n        this.playerScoreLabel.node.active = true;\n        this.dealerScoreLabel.node.active = true;\n    }\n\n    private lockInput() {\n        this.dealButton.interactable = false;\n        this.hitButton.interactable = false;\n        this.standButton.interactable = false;\n        this.doubleButton.interactable = false;\n        this.resetButton.interactable = false;\n    }\n\n    private unlockInput() {\n        this.dealButton.interactable = true;\n        this.hitButton.interactable = true;\n        this.standButton.interactable = true;\n        this.doubleButton.interactable = true;\n        this.resetButton.interactable = true;\n    }\n\n}\n\n"]}