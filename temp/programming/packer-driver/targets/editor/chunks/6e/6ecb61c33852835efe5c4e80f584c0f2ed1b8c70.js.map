{"version":3,"sources":["file:///Users/phuongduy/CardDeck/assets/scripts/AudioSystem/SFXManager.ts"],"names":["_decorator","Component","AudioSource","Prefab","instantiate","SFXEntry","ccclass","property","SFXManager","tooltip","type","visible","usePooling","clipMap","Map","maxPoolSize","onLoad","sfxEntries","forEach","entry","set","id","clip","i","node","sfxAudioSourcePrefab","setParent","active","sfxPool","push","playSFXByID","volume","get","playSFX","console","warn","singleSFXSource","playOneShot","sourceNode","find","n","getComponent","playing","audio","play","setVolume"],"mappings":"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","sourcesContent":["import { _decorator, Component, AudioSource, AudioClip, Node, Prefab, instantiate } from 'cc';\nconst { ccclass, property } = _decorator;\n\nimport { SFXID } from \"./SFXID\";\nimport { SFXEntry } from \"./SFXEntry\";\n\n@ccclass('SFXManager')\nexport class SFXManager extends Component {\n    @property({ tooltip: 'Use pooling for SFX playback' })\n    usePooling: boolean = false;\n\n    @property({ type: AudioSource, tooltip: 'Used when pooling is disabled' })\n    singleSFXSource: AudioSource = null!;\n\n    @property({ type: Prefab, tooltip: 'Used when pooling is enabled' })\n    sfxAudioSourcePrefab: Prefab = null!;\n\n    @property({ type: [SFXEntry] })\n    sfxEntries: SFXEntry[] = [];\n\n    private clipMap: Map<SFXID, AudioClip> = new Map();\n\n    @property({\n        visible() {\n            return this.usePooling;\n        }\n    })\n    private sfxPool: Node[] = [];\n    private maxPoolSize = 10;\n\n    onLoad() {\n        this.sfxEntries.forEach(entry => {\n            this.clipMap.set(entry.id, entry.clip);\n        });\n        if (this.usePooling) {\n            for (let i = 0; i < this.maxPoolSize; i++) {\n                const node = instantiate(this.sfxAudioSourcePrefab);\n                node.setParent(this.node);\n                node.active = false;\n                this.sfxPool.push(node);\n            }\n        }\n    }\n\n    public playSFXByID(id: SFXID, volume = 1.0) {\n        const clip = this.clipMap.get(id);\n        if (clip) {\n            this.playSFX(clip, volume);\n        } else {\n            console.warn(`[SFXManager] Clip not found: ${id}`);\n        }\n    }\n    \n    public playSFX(clip: AudioClip, volume = 1.0) {\n        if (!this.usePooling) {\n            this.singleSFXSource.playOneShot(clip, volume);\n            return;\n        }\n\n        const sourceNode = this.sfxPool.find(n => !n.getComponent(AudioSource).playing);\n        if (sourceNode) {\n            const audio = sourceNode.getComponent(AudioSource);\n            sourceNode.active = true;\n            audio.clip = clip;\n            audio.volume = volume;\n            audio.play();\n        } else {\n            console.warn('[SFXManager] No available SFX source in pool');\n        }\n    }\n\n    public setVolume(volume: number) {\n        if (!this.usePooling) {\n            this.singleSFXSource.volume = volume;\n        } else {\n            this.sfxPool.forEach(node => {\n                node.getComponent(AudioSource).volume = volume;\n            });\n        }\n    }\n}"]}