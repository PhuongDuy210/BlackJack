{"version":3,"sources":["file:///Users/phuongduy/CardDeck/assets/scripts/Managers/DeckManager.ts"],"names":["_decorator","Component","JsonAsset","resources","SpriteFrame","SpriteAtlas","CardAsset","Deck","EventManager","GameEvent","ccclass","property","DeckManager","loadedCardData","cardDeck","start","deckCount","length","instance","gameEvents","on","GAME_RESET","resetDeck","onDestroy","off","onLoad","load","err","asset","console","error","json","loadSpriteFromAtlas","loadSprites","promises","map","card","loadSpriteFrame","sprite","then","spriteFrame","catch","rank","suit","push","backSpriteFrame","Promise","resolve","all","log","emit","DECK_LOADED","path","reject","loadSpriteAtlas","atlas","frame","getSpriteFrame","dealCard","deal","reset"],"mappings":"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","sourcesContent":["import { _decorator, Component, JsonAsset, Node, resources, SpriteFrame, SpriteAtlas, instantiate } from 'cc';\nconst { ccclass, property } = _decorator;\nimport { CardData } from '../CardData';\nimport { CardAsset } from '../CardAsset';\nimport { Deck } from '../Deck';\nimport { EventManager } from './EventManager';\nimport { GameEvent } from '../enums/GameEvent';\n\n@ccclass('DeckManager')\nexport class DeckManager extends Component {\n\n    private loadedCardData: CardData[] = [];\n\n    private cardDeck: Deck | null = null;\n\n    start() {\n        let deckCount = this.loadedCardData.length;\n\n        EventManager.instance.gameEvents.on(GameEvent.GAME_RESET, this.resetDeck, this);\n    }\n\n    protected onDestroy(): void {\n        EventManager.instance.gameEvents.off(GameEvent.GAME_RESET, this.resetDeck, this);\n    }\n\n    onLoad() {\n        resources.load('deck', JsonAsset, (err, asset) => {\n            if (err) {\n                console.error('Failed to load card data:', err);\n                return;\n            }\n            this.loadedCardData = asset.json as CardData[];\n            // this.loadSprites();\n            this.loadSpriteFromAtlas();\n        });\n    }\n\n    private loadSprites() {\n        const promises = this.loadedCardData.map(card =>\n            this.loadSpriteFrame('sprites/Cards/'+card.sprite+'/spriteFrame').then(spriteFrame => {\n                card.spriteFrame = spriteFrame;\n            }).catch(err => {\n                console.error(`Failed to load sprite for ${card.rank} of ${card.suit}:`, err);\n            })\n        );\n\n        promises.push(CardAsset.backSpriteFrame ? Promise.resolve() : this.loadSpriteFrame('sprites/Cards/back01/spriteFrame').then(spriteFrame => {\n            CardAsset.backSpriteFrame = spriteFrame;\n        }));\n\n        Promise.all(promises).then(() => {\n            console.log('All sprites loaded, starting game...');\n            this.cardDeck = new Deck(this.loadedCardData, 2);\n            EventManager.instance.gameEvents.emit(GameEvent.DECK_LOADED);\n        }).catch(err => {\n            console.error('Error loading deck:', err);\n        });\n    }\n\n    private loadSpriteFrame(path: string): Promise<SpriteFrame> {\n        return new Promise((resolve, reject) => {\n            resources.load(path, SpriteFrame, (err, spriteFrame) => {\n                if (err) reject(err);\n                else resolve(spriteFrame);\n            });\n        });\n    }\n\n    private loadSpriteAtlas(): Promise<SpriteAtlas> {\n        return new Promise((resolve, reject) => {\n            resources.load('Cards/card/spriteAtlas', SpriteAtlas, (err, atlas) => {\n                if (err) reject(err);\n                else resolve(atlas);\n            });\n        });\n    }\n\n    async loadSpriteFromAtlas() {\n        const atlas = await this.loadSpriteAtlas();\n        console.log('Atlas loaded');\n        this.loadedCardData.map(card => {\n            const frame = atlas.getSpriteFrame(card.sprite);\n            if (frame) {\n                card.spriteFrame = frame;\n                console.log('Load spriteFrame:' + card.sprite);\n            } else {\n                console.error('Failed to load spriteFrame:' + card.sprite);\n            }\n        })\n    }\n\n    public dealCard(): CardData | null {\n        if (this.cardDeck) {\n            return this.cardDeck.deal();\n        }\n        return null;\n    }\n\n    public resetDeck() {\n        if (this.loadedCardData.length > 0) {\n            console.log('Resetting deck...');\n            this.cardDeck.reset(this.loadedCardData, 2);\n            EventManager.instance.gameEvents.emit(GameEvent.DECK_LOADED);\n        }\n    }\n}\n\n"]}