{"version":3,"sources":["file:///Users/phuongduy/CardDeck/assets/scripts/Managers/UIManager.ts"],"names":["_decorator","Button","Component","Node","Prefab","instantiate","Vec3","Label","tween","EventManager","GameEvent","Card","Player","Dealer","ccclass","property","UIManager","animationInProgress","start","instance","gameEvents","on","DECK_LOADED","onDeckLoaded","GAME_STARTED","onGameStarted","DEAL_CARD","addCardToParticipant","GAME_ENDED","displayResult","GAME_RESET","resetUI","DEALER_TURN_END","flipDealerCards","console","log","dealButton","interactable","node","active","hitButton","standButton","doubleButton","resultLabel","resetButton","playerCardContainer","removeAllChildren","dealerCardContainer","onDestroy","off","participant","handArea","hand","getHand","cardsToDeal","slice","children","length","animations","map","card","animateCardToHand","Promise","all","emit","ANIMATION_FINISHED","latestCardData","displayedCardCount","cardNode","cardPrefab","addComponent","init","isFaceDown","revealAll","addChild","setWorldPosition","deckPosition","getWorldPosition","targetPos","getCardTargetPosition","rank","suit","resolve","to","position","call","flipCard","checkRemainingAnimation","dealerCardNodes","i","getComponent","updateCardDisplay","cardDataList","cardData","playerCardNodes","push","setPosition","Math","floor","cardIndex","xOffset","yOffset","x","y","result","string"],"mappings":"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","sourcesContent":["import { _decorator, Button, Component, Node, Prefab, instantiate, Vec3, Label, tween } from 'cc';\nimport { EventManager } from './EventManager';\nimport { GameEvent } from '../enums/GameEvent';\nimport { Card } from '../Card';\nimport { CardData } from '../CardData';\nimport { CardAsset } from '../CardAsset';\n\nimport { Participant } from '../Participant';\nimport { Player } from '../Player';\nimport { Dealer } from '../Dealer';\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('UIManager')\nexport class UIManager extends Component {\n    @property(Prefab)\n    private cardPrefab: Prefab = null!;\n\n    @property(Label)\n    private resultLabel: Label = null!;\n\n    @property(Button)\n    private dealButton: Button = null!;\n\n    @property(Button)\n    private hitButton: Button = null!;\n\n    @property(Button)\n    private standButton: Button = null!;\n\n    @property(Button)\n    private doubleButton: Button = null!;\n\n    @property(Button)\n    private resetButton: Button = null!;\n\n    @property(Node)\n    private deckPosition: Node = null!;\n\n    @property(Node)\n    private playerCardContainer: Node = null!;\n\n    @property(Node)\n    private dealerCardContainer: Node = null!;\n\n    private animationInProgress: number = 0;\n\n    start() {\n        EventManager.instance.gameEvents.on(GameEvent.DECK_LOADED, this.onDeckLoaded, this);\n        EventManager.instance.gameEvents.on(GameEvent.GAME_STARTED, this.onGameStarted, this);\n        EventManager.instance.gameEvents.on(GameEvent.DEAL_CARD, this.addCardToParticipant, this);\n        EventManager.instance.gameEvents.on(GameEvent.GAME_ENDED, this.displayResult, this);\n        EventManager.instance.gameEvents.on(GameEvent.GAME_RESET, this.resetUI, this);\n        EventManager.instance.gameEvents.on(GameEvent.DEALER_TURN_END, this.flipDealerCards, this);\n\n        this.resetUI();\n    }\n\n    private resetUI() {\n        console.log('Resetting UI...');\n        this.dealButton.interactable = false;\n        this.dealButton.node.active = true;\n        this.hitButton.node.active = false;\n        this.standButton.node.active = false;\n        this.doubleButton.node.active = false;\n        this.resultLabel.node.active = false;\n        this.resetButton.node.active = false;\n\n        this.playerCardContainer.removeAllChildren();\n        this.dealerCardContainer.removeAllChildren();\n    }\n\n    protected onDestroy(): void {\n        EventManager.instance.gameEvents.off(GameEvent.DECK_LOADED, this.onDeckLoaded, this);\n        EventManager.instance.gameEvents.off(GameEvent.GAME_STARTED, this.onGameStarted, this);\n        EventManager.instance.gameEvents.off(GameEvent.DEAL_CARD, this.addCardToParticipant, this);\n        EventManager.instance.gameEvents.off(GameEvent.GAME_ENDED, this.displayResult, this);\n        EventManager.instance.gameEvents.off(GameEvent.GAME_RESET, this.resetUI, this);\n        EventManager.instance.gameEvents.off(GameEvent.DEALER_TURN_END, this.flipDealerCards, this);\n    }\n\n    private onDeckLoaded() {\n        this.dealButton.interactable = true;\n    }\n\n    private onGameStarted() {\n        this.dealButton.node.active = false;\n        this.hitButton.node.active = true;\n        this.standButton.node.active = true;\n        this.doubleButton.node.active = true;\n    }\n\n    async addCardToParticipant(participant: Participant) {\n        let handArea = null;\n        if (participant instanceof Player) {\n            handArea = this.playerCardContainer;\n        } else if (participant instanceof Dealer) {\n            handArea = this.dealerCardContainer;\n        }\n\n        const hand = participant.getHand();\n        const cardsToDeal = hand.slice(handArea.children.length);\n        // for (let i = handArea.children.length; i < hand.length; i++) {\n        //     await this.animateCardToHand(participant, handArea);\n        // }\n\n        const animations = cardsToDeal.map(card =>\n            this.animateCardToHand(card, participant, handArea)\n        );\n\n        await Promise.all(animations);\n        EventManager.instance.gameEvents.emit(GameEvent.ANIMATION_FINISHED, participant);\n    }\n\n    async animateCardToHand(latestCardData: CardData, participant: Participant, handArea: Node): Promise<void> {\n        // const hand = participant.getHand();\n        const displayedCardCount = handArea.children.length;\n        // const latestCardData = hand[displayedCardCount];\n\n        // Get or create visual card node\n        const cardNode = instantiate(this.cardPrefab);\n        let card = cardNode.addComponent(Card);\n        card.init(latestCardData);\n        \n        // Add to scene\n        if (participant instanceof Player) {\n            latestCardData.isFaceDown = false;\n        } else if (participant instanceof Dealer) {\n            latestCardData.isFaceDown = (displayedCardCount === 0 && !participant.revealAll);\n        }\n        handArea.addChild(cardNode);\n        \n        // Position at deck first\n        cardNode.setWorldPosition(this.deckPosition.getWorldPosition());\n        \n        // Animate to hand position\n        const targetPos = this.getCardTargetPosition(displayedCardCount);\n        console.log(`Animating card ${latestCardData.rank} of ${latestCardData.suit} to ${participant instanceof Player ? 'Player' : 'Dealer'}'s hand`);\n        await new Promise<void>((resolve) => {\n            tween(cardNode)\n            .to(0.5, { position: targetPos })\n            .call(async () => {\n                if (!latestCardData.isFaceDown) {\n                    this.animationInProgress++;\n                    await card.flipCard();\n                    this.animationInProgress--;\n                    this.checkRemainingAnimation(participant);\n                }\n                resolve();\n            })\n            .start();\n        });\n    }\n\n    async flipDealerCards() {\n        const dealerCardNodes = this.dealerCardContainer.children;\n        for (let i = 0; i < dealerCardNodes.length; i++) {\n            const cardNode = dealerCardNodes[i];\n            const card = cardNode.getComponent(Card);\n            if (card.isFaceDown) {\n                this.animationInProgress++;\n                await card.flipCard();\n                this.animationInProgress--;\n                this.checkRemainingAnimation(new Dealer);\n            }\n        }\n\n    }\n\n    private checkRemainingAnimation(participant: Participant) {\n        console.log('Checking remaining animations:', this.animationInProgress);\n        if (this.animationInProgress <= 0) {\n            console.log('All animations finished.');\n            EventManager.instance.gameEvents.emit(GameEvent.ANIMATION_FINISHED, participant);\n        }\n    }\n\n    public updateCardDisplay(hand: Participant) {\n        if (hand instanceof Player) {\n            // Update player card display\n            const cardDataList = hand.getHand();\n            for (let i = 0; i < cardDataList.length; i++) {\n                const cardData = { ...cardDataList[i] }; // Clone to avoid mutating original\n                const cardNode = instantiate(this.cardPrefab);\n                this.playerCardNodes.push(cardNode);\n                cardNode.setPosition((i % 13) * 30, Math.floor(i / 13) * -40, 0);\n                this.playerCardContainer.addChild(cardNode);\n                let card = cardNode.addComponent(Card);\n                card.init(cardData);\n            }\n        } else if (hand instanceof Dealer) {\n            // Update dealer card display\n            const cardDataList = hand.getHand();\n            for (let i = 0; i < cardDataList.length; i++) {\n                const cardData = { ...cardDataList[i] }; // Clone to avoid mutating original\n                cardData.isFaceDown = (i === 0 && !hand.revealAll);\n                \n                const cardNode = instantiate(this.cardPrefab);\n                this.dealerCardNodes.push(cardNode);\n                cardNode.setPosition((i % 13) * 30, Math.floor(i / 13) * -40, 0);\n                this.dealerCardContainer.addChild(cardNode);\n                let card = cardNode.addComponent(Card);\n                card.init(cardData);\n            }\n        }   \n    }\n\n    private getCardTargetPosition(cardIndex: number): Vec3 {\n        const xOffset = 30;\n        const yOffset = -40;\n        const x = (cardIndex % 13) * xOffset;\n        const y = Math.floor(cardIndex / 13) * yOffset;\n        return new Vec3(x, y, 0);\n    }\n\n    private displayResult(result: string) {\n        // Implement result display logic (e.g., show a popup or update a label)\n        console.log('Game Result:', result);\n        this.resultLabel.node.active = true;\n        this.resultLabel.string = result;\n        this.hitButton.node.active = false;\n        this.standButton.node.active = false;\n        this.resetButton.node.active = true;\n        this.doubleButton.node.active = false;\n    }\n}\n\n"]}