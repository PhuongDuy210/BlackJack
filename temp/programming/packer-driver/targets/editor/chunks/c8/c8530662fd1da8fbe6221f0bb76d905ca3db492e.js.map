{"version":3,"sources":["file:///Users/phuongduy/CardDeck/assets/scripts/Managers/DeckManager.ts"],"names":["_decorator","Component","JsonAsset","resources","SpriteFrame","Prefab","Deck","EventManager","GameEvent","ccclass","property","DeckManager","loadedCardData","cardDeck","start","deckCount","length","i","cardData","onLoad","load","err","asset","console","error","json","loadSprites","promises","map","card","loadSpriteFrame","sprite","then","spriteFrame","catch","rank","suit","Promise","all","log","instance","gameEvents","emit","DECK_LOADED","path","resolve","reject","dealCard","deal"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,M,OAAAA,M;;AAIhEC,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,S,iBAAAA,S;;;;;;;;;OALH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBV,U;;6BAQjBW,W,WADZF,OAAO,CAAC,aAAD,C,UAGHC,QAAQ,CAACL,MAAD,C,2BAHb,MACaM,WADb,SACiCV,SADjC,CAC2C;AAAA;AAAA;;AAAA;;AAAA,eAK/BW,cAL+B,GAKF,EALE;AAAA,eAO/BC,QAP+B,GAOP,IAPO;AAAA;;AASvCC,QAAAA,KAAK,GAAG;AACJ,cAAIC,SAAS,GAAG,KAAKH,cAAL,CAAoBI,MAApC;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,SAApB,EAA+BE,CAAC,EAAhC,EAAoC;AAChC,kBAAMC,QAAQ,GAAG,KAAKN,cAAL,CAAoBK,CAApB,CAAjB;AACH;AACJ;;AAEDE,QAAAA,MAAM,GAAG;AACLhB,UAAAA,SAAS,CAACiB,IAAV,CAAe,MAAf,EAAuBlB,SAAvB,EAAkC,CAACmB,GAAD,EAAMC,KAAN,KAAgB;AAC9C,gBAAID,GAAJ,EAAS;AACLE,cAAAA,OAAO,CAACC,KAAR,CAAc,2BAAd,EAA2CH,GAA3C;AACA;AACH;;AACD,iBAAKT,cAAL,GAAsBU,KAAK,CAACG,IAA5B;AACA,iBAAKC,WAAL;AACH,WAPD;AAQH;;AAEDA,QAAAA,WAAW,GAAG;AACV,gBAAMC,QAAQ,GAAG,KAAKf,cAAL,CAAoBgB,GAApB,CAAwBC,IAAI,IACzC,KAAKC,eAAL,CAAqB,mBAAiBD,IAAI,CAACE,MAAtB,GAA6B,cAAlD,EAAkEC,IAAlE,CAAuEC,WAAW,IAAI;AAClFJ,YAAAA,IAAI,CAACI,WAAL,GAAmBA,WAAnB;AACH,WAFD,EAEGC,KAFH,CAESb,GAAG,IAAI;AACZE,YAAAA,OAAO,CAACC,KAAR,CAAe,6BAA4BK,IAAI,CAACM,IAAK,OAAMN,IAAI,CAACO,IAAK,GAArE,EAAyEf,GAAzE;AACH,WAJD,CADa,CAAjB;AAQAgB,UAAAA,OAAO,CAACC,GAAR,CAAYX,QAAZ,EAAsBK,IAAtB,CAA2B,MAAM;AAC7BT,YAAAA,OAAO,CAACgB,GAAR,CAAY,sCAAZ;AACA,iBAAK1B,QAAL,GAAgB;AAAA;AAAA,8BAAS,KAAKD,cAAd,EAA8B,CAA9B,CAAhB;AACA;AAAA;AAAA,8CAAa4B,QAAb,CAAsBC,UAAtB,CAAiCC,IAAjC,CAAsC;AAAA;AAAA,wCAAUC,WAAhD;AACH,WAJD,EAIGT,KAJH,CAISb,GAAG,IAAI;AACZE,YAAAA,OAAO,CAACC,KAAR,CAAc,wBAAd,EAAwCH,GAAxC;AACH,WAND;AAOH;;AAEOS,QAAAA,eAAe,CAACc,IAAD,EAAqC;AACxD,iBAAO,IAAIP,OAAJ,CAAY,CAACQ,OAAD,EAAUC,MAAV,KAAqB;AACpC3C,YAAAA,SAAS,CAACiB,IAAV,CAAewB,IAAf,EAAqBxC,WAArB,EAAkC,CAACiB,GAAD,EAAMY,WAAN,KAAsB;AACpD,kBAAIZ,GAAJ,EAASyB,MAAM,CAACzB,GAAD,CAAN,CAAT,KACKwB,OAAO,CAACZ,WAAD,CAAP;AACR,aAHD;AAIH,WALM,CAAP;AAMH;;AAEMc,QAAAA,QAAQ,GAAoB;AAC/B,cAAI,KAAKlC,QAAT,EAAmB;AACf,mBAAO,KAAKA,QAAL,CAAcmC,IAAd,EAAP;AACH;;AACD,iBAAO,IAAP;AACH;;AA3DsC,O;;;;;iBAGV,I","sourcesContent":["import { _decorator, Component, JsonAsset, Node, resources, SpriteFrame, Prefab, instantiate } from 'cc';\nconst { ccclass, property } = _decorator;\nimport { CardData } from '../CardData';\nimport { Card } from '../Card';\nimport { Deck } from '../Deck';\nimport { EventManager } from './EventManager';\nimport { GameEvent } from '../enums/GameEvent';\n\n@ccclass('DeckManager')\nexport class DeckManager extends Component {\n\n    @property(Prefab)\n    private cardPrefab: Prefab = null!;\n\n    private loadedCardData: CardData[] = [];\n\n    private cardDeck: Deck | null = null;\n\n    start() {\n        let deckCount = this.loadedCardData.length;\n        for (let i = 0; i < deckCount; i++) {\n            const cardData = this.loadedCardData[i];\n        }\n    }\n\n    onLoad() {\n        resources.load('deck', JsonAsset, (err, asset) => {\n            if (err) {\n                console.error('Failed to load card data:', err);\n                return;\n            }\n            this.loadedCardData = asset.json as CardData[];\n            this.loadSprites();\n        });\n    }\n\n    loadSprites() {\n        const promises = this.loadedCardData.map(card =>\n            this.loadSpriteFrame('sprites/Cards/'+card.sprite+'/spriteFrame').then(spriteFrame => {\n                card.spriteFrame = spriteFrame;\n            }).catch(err => {\n                console.error(`Failed to load sprite for ${card.rank} of ${card.suit}:`, err);\n            })\n        );\n\n        Promise.all(promises).then(() => {\n            console.log('All sprites loaded, starting game...');\n            this.cardDeck = new Deck(this.loadedCardData, 2);\n            EventManager.instance.gameEvents.emit(GameEvent.DECK_LOADED);\n        }).catch(err => {\n            console.error('Error loading sprites:', err);\n        });\n    }\n\n    private loadSpriteFrame(path: string): Promise<SpriteFrame> {\n        return new Promise((resolve, reject) => {\n            resources.load(path, SpriteFrame, (err, spriteFrame) => {\n                if (err) reject(err);\n                else resolve(spriteFrame);\n            });\n        });\n    }\n\n    public dealCard(): CardData | null {\n        if (this.cardDeck) {\n            return this.cardDeck.deal();\n        }\n        return null;\n    }\n}\n\n"]}